<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Used Car Listings</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .logo {
            max-width: 150px;
            height: auto;
            margin-bottom: 10px;
        }
        .car-card-carousel {
            position: relative;
            width: 100%;
            height: 250px;
            overflow: hidden;
            border-bottom: 1px solid #333;
        }
        .car-card-carousel img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
            transition: opacity 0.5s ease-in-out;
            position: absolute;
            top: 0;
            left: 0;
        }
        .car-card-carousel img.active {
            display: block;
            opacity: 1;
        }
        .carousel-nav {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            transform: translateY(-50%);
            z-index: 10;
        }
        .carousel-nav button {
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            font-size: 1.5rem;
            border-radius: 50%;
            margin: 0 5px;
            transition: background-color 0.3s;
        }
        .carousel-nav button:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }
    </style>
</head>
<body class="dark-theme">
    <header>
        <a href="{{ url_for('index') }}" class="logo-link">
            <img src="{{ url_for('static', filename='images/carlogo.jpg') }}" alt="Aash Auto Works Logo" class="logo">
        </a>
        <h1>Aash Auto Works Pvt Ltd</h1>
        <p class="certified-text">Certified Used Car Seller</p>
        <nav>
            <a href="/">Home</a>
            <a href="/services">Our Services</a>
        </nav>
    </header>

    <main class="car-listings">
        {% if cars %}
            {% for car in cars %}
            <div class="car-card">
                <div class="car-card-carousel">
                    {% for photo in car.photos %}
                        <img src="{{ url_for('static', filename='uploads/' + photo.split('/')[-1]) }}?v={{ car.id }}" alt="{{ car.make }} {{ car.model }} photo {{ loop.index }}" class="carousel-image {% if loop.first %}active{% endif %}">
                    {% endfor %}
                    <div class="carousel-nav">
                        <button class="prev-button">&lt;</button>
                        <button class="next-button">&gt;</button>
                    </div>
                </div>
                <div class="car-info">
                    <h2>{{ car.make }} {{ car.model }} ({{ car.year }})</h2>
                    <p><strong>Price:</strong> {{ car.price }}</p>
                    <p>{{ car.details }}</p>
                    {% if current_user.is_authenticated %}
                        <form action="{{ url_for('delete_car', car_id=car.id) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this listing?');">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="delete-button">Delete</button>
                        </form>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p class="no-cars-message">No cars have been uploaded yet.</p>
        {% endif %}
    </main>

    <footer>
        <p>&copy; 2024 Aash Auto Works Pvt Ltd</p>
    </footer>

    <script>
        document.querySelectorAll('.car-card').forEach(card => {
            const images = card.querySelectorAll('.carousel-image');
            const prevButton = card.querySelector('.prev-button');
            const nextButton = card.querySelector('.next-button');
            let currentImageIndex = 0;

            function showImage(index) {
                images.forEach((img, i) => {
                    img.classList.remove('active');
                    if (i === index) {
                        img.classList.add('active');
                    }
                });
            }

            nextButton.addEventListener('click', () => {
                currentImageIndex = (currentImageIndex + 1) % images.length;
                showImage(currentImageIndex);
            });

            prevButton.addEventListener('click', () => {
                currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
                showImage(currentImageIndex);
            });
        });
    </script>
</body>
</html>
